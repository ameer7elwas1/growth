# نظام النسخ الاحتياطي لقاعدة البيانات
# Database Backup System

## نظرة عامة
نظام شامل للنسخ الاحتياطي وإدارة البيانات لمشروع HTML مع دعم قاعدة البيانات السحابية (Supabase) والتخزين المحلي (localStorage).

## الملفات المتضمنة

### 1. أدوات النسخ الاحتياطي الأساسية
- **`database_backup_tool.html`** - واجهة ويب تفاعلية لإدارة النسخ الاحتياطي
- **`database_backup_manager.bat`** - قائمة إدارة شاملة لجميع العمليات
- **`database_backup.ps1`** - سكريبت PowerShell متقدم لنسخ قاعدة البيانات
- **`database_import.ps1`** - سكريبت استيراد البيانات من الملفات

### 2. أدوات النسخ الاحتياطي للملفات
- **`easy_backup.bat`** - نسخ احتياطي سريع للملفات
- **`auto_backup_simple.ps1`** - سكريبت PowerShell للملفات
- **`backup_manager.bat`** - إدارة نسخ الملفات

## كيفية الاستخدام

### الطريقة السريعة (واجهة ويب)
1. انقر نقرة مزدوجة على `database_backup_tool.html`
2. اختر العملية المطلوبة:
   - **تصدير البيانات**: تصدير جميع بيانات localStorage
   - **استيراد البيانات**: إضافة بيانات من ملف JSON
   - **استعادة البيانات**: مسح البيانات الحالية واستبدالها

### الطريقة المتقدمة (قائمة الإدارة)
1. انقر نقرة مزدوجة على `database_backup_manager.bat`
2. اختر من القائمة التفاعلية:
   - فتح أداة النسخ الاحتياطي
   - نسخ احتياطي سريع للملفات
   - نسخ احتياطي لقاعدة البيانات
   - استيراد البيانات من ملف
   - إدارة النسخ الاحتياطية

### النسخ الاحتياطي لقاعدة البيانات السحابية
```powershell
# إعداد معلومات Supabase أولاً في السكريبت
.\database_backup.ps1 -SupabaseUrl "your-url" -SupabaseKey "your-key" -Compress
```

### استيراد البيانات
```powershell
# استيراد عادي
.\database_import.ps1 -ImportFile "path\to\backup.json"

# استعادة كاملة
.\database_import.ps1 -ImportFile "path\to\backup.json" -RestoreMode
```

## هيكل النظام

### مجلدات النسخ الاحتياطية
```
d:\Projects\HTML\growth\
├── database_backups\          # نسخ قاعدة البيانات
│   ├── database_backup_*.zip  # نسخ مضغوطة
│   ├── supabase_data_*.json  # بيانات Supabase
│   ├── export_localStorage_*.html  # سكريبتات التصدير
│   ├── import_data_*.html     # سكريبتات الاستيراد
│   ├── backup_log.txt        # سجل النسخ الاحتياطي
│   └── import_log.txt        # سجل الاستيراد
├── backups\                   # نسخ الملفات
│   ├── agents_growth_iraqcell_backup_*.html
│   ├── backup_log.txt
│   └── README.md
└── [ملفات النظام الأخرى]
```

### تنسيق ملفات النسخ الاحتياطية
```json
{
  "timestamp": "2025-01-07T16:30:00.000Z",
  "version": "1.0",
  "data": {
    "users": "[JSON data]",
    "agents": "[JSON data]",
    "sales": "[JSON data]"
  },
  "metadata": {
    "itemCount": 150,
    "exportDate": "2025-01-07 16:30:00",
    "userAgent": "Mozilla/5.0..."
  }
}
```

## الميزات المتقدمة

### 1. النسخ الاحتياطي التلقائي
- دعم Supabase REST API
- تصدير بيانات localStorage
- ضغط النسخ الاحتياطية
- إدارة النسخ القديمة

### 2. الاستيراد والاستعادة
- استيراد تدريجي (إضافة للبيانات الموجودة)
- استعادة كاملة (مسح واستبدال)
- التحقق من صحة البيانات
- سجلات مفصلة للعمليات

### 3. إدارة النسخ الاحتياطية
- تنظيف تلقائي للنسخ القديمة
- إحصائيات مفصلة (العدد، الحجم، التواريخ)
- سجلات العمليات
- واجهة سهلة الاستخدام

## إعداد Supabase

### 1. الحصول على معلومات الاتصال
- URL: `https://your-project.supabase.co`
- API Key: من لوحة التحكم في Supabase

### 2. تحديث السكريبت
```powershell
# في database_backup.ps1
$SupabaseUrl = "https://your-project.supabase.co"
$SupabaseKey = "your-anon-key"
```

### 3. الجداول المدعومة
- `users` - المستخدمين
- `agents` - الوكلاء
- `sales` - المبيعات
- `transactions` - المعاملات
- `reports` - التقارير

## استكشاف الأخطاء

### مشاكل شائعة وحلولها

1. **خطأ في الاتصال بـ Supabase**
   - تحقق من صحة URL و API Key
   - تأكد من إعدادات CORS
   - تحقق من صلاحيات الجداول

2. **فشل في تصدير localStorage**
   - تأكد من تشغيل السكريبت في المتصفح
   - تحقق من إعدادات الأمان في المتصفح

3. **خطأ في استيراد البيانات**
   - تحقق من تنسيق ملف JSON
   - تأكد من صحة البيانات المستوردة
   - تحقق من مساحة التخزين المتاحة

### رسائل الخطأ الشائعة
- `تنسيق الملف غير صحيح` - تحقق من صحة ملف JSON
- `فشل في الاتصال بقاعدة البيانات` - تحقق من إعدادات Supabase
- `لا توجد بيانات للتصدير` - تحقق من وجود بيانات في localStorage

## الأمان والخصوصية

### حماية البيانات
- تشفير البيانات الحساسة قبل التصدير
- استخدام HTTPS للاتصال بقاعدة البيانات
- عدم حفظ كلمات المرور في النسخ الاحتياطية

### أفضل الممارسات
- إنشاء نسخ احتياطية منتظمة
- اختبار عمليات الاستعادة
- حفظ النسخ في مواقع متعددة
- مراجعة السجلات بانتظام

## الدعم والمساعدة

### ملفات السجل
- `database_backups\backup_log.txt` - سجل النسخ الاحتياطي
- `database_backups\import_log.txt` - سجل الاستيراد
- `backups\backup_log.txt` - سجل نسخ الملفات

### معلومات النظام
- Windows 10/11
- PowerShell 5.1 أو أحدث
- متصفح حديث يدعم localStorage
- اتصال إنترنت للوصول إلى Supabase

---

**ملاحظة مهمة:** تأكد من اختبار النظام في بيئة آمنة قبل الاعتماد عليه في الإنتاج. يُنصح بإنشاء نسخة احتياطية يدوية أولاً للتأكد من صحة الإعدادات.
